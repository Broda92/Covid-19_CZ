let districts_properties = {
    "Okresy": [
        {
            "okres_kod": "CZ0100",
            "okres_nazev": "Hlavní město Praha",
            "obyv_2019": "1308632"
        },
        {
            "okres_kod": "CZ0201",
            "okres_nazev": "Benešov",
            "obyv_2019": "98708"
        },
        {
            "okres_kod": "CZ0202",
            "okres_nazev": "Beroun",
            "obyv_2019": "93726"
        },
        {
            "okres_kod": "CZ0203",
            "okres_nazev": "Kladno",
            "obyv_2019": "165271"
        },
        {
            "okres_kod": "CZ0204",
            "okres_nazev": "Kolín",
            "obyv_2019": "101604"
        },
        {
            "okres_kod": "CZ0205",
            "okres_nazev": "Kutná Hora",
            "obyv_2019": "75370"
        },
        {
            "okres_kod": "CZ0206",
            "okres_nazev": "Mělník",
            "obyv_2019": "108352"
        },
        {
            "okres_kod": "CZ0207",
            "okres_nazev": "Mladá Boleslav",
            "obyv_2019": "129136"
        },
        {
            "okres_kod": "CZ0208",
            "okres_nazev": "Nymburk",
            "obyv_2019": "99873"
        },
        {
            "okres_kod": "CZ0209",
            "okres_nazev": "Praha-východ",
            "obyv_2019": "180945"
        },
        {
            "okres_kod": "CZ020A",
            "okres_nazev": "Praha-západ",
            "obyv_2019": "146004"
        },
        {
            "okres_kod": "CZ020B",
            "okres_nazev": "Příbram",
            "obyv_2019": "114778"
        },
        {
            "okres_kod": "CZ020C",
            "okres_nazev": "Rakovník",
            "obyv_2019": "55565"
        },
        {
            "okres_kod": "CZ0311",
            "okres_nazev": "České Budějovice",
            "obyv_2019": "194585"
        },
        {
            "okres_kod": "CZ0312",
            "okres_nazev": "Český Krumlov",
            "obyv_2019": "61381"
        },
        {
            "okres_kod": "CZ0313",
            "okres_nazev": "Jindřichův Hradec",
            "obyv_2019": "90653"
        },
        {
            "okres_kod": "CZ0314",
            "okres_nazev": "Písek",
            "obyv_2019": "71308"
        },
        {
            "okres_kod": "CZ0315",
            "okres_nazev": "Prachatice",
            "obyv_2019": "50971"
        },
        {
            "okres_kod": "CZ0316",
            "okres_nazev": "Strakonice",
            "obyv_2019": "70738"
        },
        {
            "okres_kod": "CZ0317",
            "okres_nazev": "Tábor",
            "obyv_2019": "102497"
        },
        {
            "okres_kod": "CZ0321",
            "okres_nazev": "Domažlice",
            "obyv_2019": "61902"
        },
        {
            "okres_kod": "CZ0322",
            "okres_nazev": "Klatovy",
            "obyv_2019": "86336"
        },
        {
            "okres_kod": "CZ0323",
            "okres_nazev": "Plzeň-město",
            "obyv_2019": "191599"
        },
        {
            "okres_kod": "CZ0324",
            "okres_nazev": "Plzeň-jih",
            "obyv_2019": "63004"
        },
        {
            "okres_kod": "CZ0325",
            "okres_nazev": "Plzeň-sever",
            "obyv_2019": "79278"
        },
        {
            "okres_kod": "CZ0326",
            "okres_nazev": "Rokycany",
            "obyv_2019": "48966"
        },
        {
            "okres_kod": "CZ0327",
            "okres_nazev": "Tachov",
            "obyv_2019": "53587"
        },
        {
            "okres_kod": "CZ0411",
            "okres_nazev": "Cheb",
            "obyv_2019": "91540"
        },
        {
            "okres_kod": "CZ0412",
            "okres_nazev": "Karlovy Vary",
            "obyv_2019": "115014"
        },
        {
            "okres_kod": "CZ0413",
            "okres_nazev": "Sokolov",
            "obyv_2019": "88342"
        },
        {
            "okres_kod": "CZ0421",
            "okres_nazev": "Děčín",
            "obyv_2019": "129831"
        },
        {
            "okres_kod": "CZ0422",
            "okres_nazev": "Chomutov",
            "obyv_2019": "124751"
        },
        {
            "okres_kod": "CZ0423",
            "okres_nazev": "Litoměřice",
            "obyv_2019": "119655"
        },
        {
            "okres_kod": "CZ0424",
            "okres_nazev": "Louny",
            "obyv_2019": "86486"
        },
        {
            "okres_kod": "CZ0425",
            "okres_nazev": "Most",
            "obyv_2019": "112049"
        },
        {
            "okres_kod": "CZ0426",
            "okres_nazev": "Teplice",
            "obyv_2019": "128610"
        },
        {
            "okres_kod": "CZ0427",
            "okres_nazev": "Ústí nad Labem",
            "obyv_2019": "119407"
        },
        {
            "okres_kod": "CZ0511",
            "okres_nazev": "Česká Lípa",
            "obyv_2019": "103135"
        },
        {
            "okres_kod": "CZ0512",
            "okres_nazev": "Jablonec nad Nisou",
            "obyv_2019": "90528"
        },
        {
            "okres_kod": "CZ0513",
            "okres_nazev": "Liberec",
            "obyv_2019": "174811"
        },
        {
            "okres_kod": "CZ0514",
            "okres_nazev": "Semily",
            "obyv_2019": "73882"
        },
        {
            "okres_kod": "CZ0521",
            "okres_nazev": "Hradec Králové",
            "obyv_2019": "163671"
        },
        {
            "okres_kod": "CZ0522",
            "okres_nazev": "Jičín",
            "obyv_2019": "79782"
        },
        {
            "okres_kod": "CZ0523",
            "okres_nazev": "Náchod",
            "obyv_2019": "110240"
        },
        {
            "okres_kod": "CZ0524",
            "okres_nazev": "Rychnov nad Kněžnou",
            "obyv_2019": "79088"
        },
        {
            "okres_kod": "CZ0525",
            "okres_nazev": "Trutnov",
            "obyv_2019": "118240"
        },
        {
            "okres_kod": "CZ0531",
            "okres_nazev": "Chrudim",
            "obyv_2019": "104344"
        },
        {
            "okres_kod": "CZ0532",
            "okres_nazev": "Pardubice",
            "obyv_2019": "173329"
        },
        {
            "okres_kod": "CZ0533",
            "okres_nazev": "Svitavy",
            "obyv_2019": "104401"
        },
        {
            "okres_kod": "CZ0534",
            "okres_nazev": "Ústí nad Orlicí",
            "obyv_2019": "138242"
        },
        {
            "okres_kod": "CZ0631",
            "okres_nazev": "Havlíčkův Brod",
            "obyv_2019": "94732"
        },
        {
            "okres_kod": "CZ0632",
            "okres_nazev": "Jihlava",
            "obyv_2019": "113153"
        },
        {
            "okres_kod": "CZ0633",
            "okres_nazev": "Pelhřimov",
            "obyv_2019": "72226"
        },
        {
            "okres_kod": "CZ0634",
            "okres_nazev": "Třebíč",
            "obyv_2019": "111069"
        },
        {
            "okres_kod": "CZ0635",
            "okres_nazev": "Žďár nad Sázavou",
            "obyv_2019": "118094"
        },
        {
            "okres_kod": "CZ0641",
            "okres_nazev": "Blansko",
            "obyv_2019": "108801"
        },
        {
            "okres_kod": "CZ0642",
            "okres_nazev": "Brno-město",
            "obyv_2019": "380681"
        },
        {
            "okres_kod": "CZ0643",
            "okres_nazev": "Brno-venkov",
            "obyv_2019": "222370"
        },
        {
            "okres_kod": "CZ0644",
            "okres_nazev": "Břeclav",
            "obyv_2019": "115906"
        },
        {
            "okres_kod": "CZ0645",
            "okres_nazev": "Hodonín",
            "obyv_2019": "154160"
        },
        {
            "okres_kod": "CZ0646",
            "okres_nazev": "Vyškov",
            "obyv_2019": "91645"
        },
        {
            "okres_kod": "CZ0647",
            "okres_nazev": "Znojmo",
            "obyv_2019": "114104"
        },
        {
            "okres_kod": "CZ0711",
            "okres_nazev": "Jeseník",
            "obyv_2019": "38330"
        },
        {
            "okres_kod": "CZ0712",
            "okres_nazev": "Olomouc",
            "obyv_2019": "234939"
        },
        {
            "okres_kod": "CZ0713",
            "okres_nazev": "Prostějov",
            "obyv_2019": "108587"
        },
        {
            "okres_kod": "CZ0714",
            "okres_nazev": "Přerov",
            "obyv_2019": "129925"
        },
        {
            "okres_kod": "CZ0715",
            "okres_nazev": "Šumperk",
            "obyv_2019": "120711"
        },
        {
            "okres_kod": "CZ0721",
            "okres_nazev": "Kroměříž",
            "obyv_2019": "105572"
        },
        {
            "okres_kod": "CZ0722",
            "okres_nazev": "Uherské Hradiště",
            "obyv_2019": "142306"
        },
        {
            "okres_kod": "CZ0723",
            "okres_nazev": "Vsetín",
            "obyv_2019": "143332"
        },
        {
            "okres_kod": "CZ0724",
            "okres_nazev": "Zlín",
            "obyv_2019": "191711"
        },
        {
            "okres_kod": "CZ0801",
            "okres_nazev": "Bruntál",
            "obyv_2019": "92018"
        },
        {
            "okres_kod": "CZ0802",
            "okres_nazev": "Frýdek-Místek",
            "obyv_2019": "214187"
        },
        {
            "okres_kod": "CZ0803",
            "okres_nazev": "Karviná",
            "obyv_2019": "247887"
        },
        {
            "okres_kod": "CZ0804",
            "okres_nazev": "Nový Jičín",
            "obyv_2019": "151680"
        },
        {
            "okres_kod": "CZ0805",
            "okres_nazev": "Opava",
            "obyv_2019": "176254"
        },
        {
            "okres_kod": "CZ0806",
            "okres_nazev": "Ostrava-město",
            "obyv_2019": "321273"
        }
    ]
}

districts_properties = districts_properties['Okresy']	
var data;
var date = [];
var date3 = [];
var date5 = [];
var districts_lau_codes = [[],[],[],[]];
var axisX;
var mode;
var headline;
var target;

//var csv is the CSV file with headers
function csvJSON(csv){
  var lines=csv.split("\n");
  var result = [];
  var headers=lines[0].split(",");

  for (var i=1;i<lines.length;i++){
      var obj = {};
      var currentline=lines[i].split(",");

      for (var j=0;j<headers.length;j++){
          obj[headers[j]] = currentline[j];
      }
      result.push(obj);
  }  
  return result; //JSON
}

function setting() {
	let request = new XMLHttpRequest();
	request.open('GET', 'https://onemocneni-aktualne.mzcr.cz/api/v2/covid-19/kraj-okres-nakazeni-vyleceni-umrti.csv');	

	request.onreadystatechange = function () {
	  if (this.readyState === 4) {		
		data = csvJSON(this.response)		
		data.forEach(item => {
		item["kumulativni_pocet_umrti"] = item["kumulativni_pocet_umrti\r"]
		delete item["kumulativni_pocet_umrti\r"]
		if (item["okres_lau_kod"] == "") {item["okres_lau_kod"] = undefined}
		if (item["kraj_nuts_kod"] == "") {item["kraj_nuts_kod"] = undefined}
		})
	  }
	};
	request.send();	

	let request3 = new XMLHttpRequest();
	request3.open('GET','https://onemocneni-aktualne.mzcr.cz/api/v2/covid-19/nakazeni-vyleceni-umrti-testy.csv');

	request3.onreadystatechange = function() {
		if (this.readyState === 4) {
			data_CZ = csvJSON(this.response)
		}
	}	
	request3.send();		

	setTimeout(function(){
		if (data && data_CZ && districts_properties) {
			setting_date1(data, axisX, districts_properties, "abs", "myChart1");
			setting_date1(data, axisX, districts_properties, "rel", "myChart2");
			setting_date3(data_CZ, axisX);
			update_date_text();
		} else {
			if (window.confirm("Data se nepodařilo načíst! Prosím, aktualizujte stránku.")) {
				location.reload()
			}
		}		
	}, 3000);
}

setting();

function update_date_text() {
	$("#tiraz").append("Poslední aktualizace: "+moment(data['modified']).locale('cs').format("LLLL"));
};

function setting_date1(data_file, axisX, districts_properties, mode, target) {
		for (i in data) {
			if (date && (!(date.includes(data[i]['datum'])))) {
				date.push(data[i]['datum']);
			}
		}
	setting_numbers1(data, date, districts_properties, mode, target);
}

function onlyUnique(value, index, self) {
		return self.indexOf(value) === index;
	}

function setting_numbers1(data_file, axisX, districts_properties, mode, target) {
	for (i in data) {
		if (districts_lau_codes && (!(districts_lau_codes[1].includes(data[i]['okres_lau_kod'])))) {
			districts_lau_codes[1].push(data[i]['okres_lau_kod']);			
			for (j in districts_properties) {
				if (districts_properties[j]['okres_kod'].includes(data[i]['okres_lau_kod'])) {
					districts_lau_codes[0].push(districts_properties[j]['okres_nazev']);
					districts_lau_codes[2].push(districts_properties[j]['obyv_2019']);
					districts_lau_codes[3].push(data[i]['okres_lau_kod'].substring(0,5));
				}
			}			
		}
	}	

	let districts = [];
	let amount;
	let percentage;
	const region_colors = ["red","orange","yellow","green","lime","blue","darkblue","blueviolet","magenta","gray","black","saddlebrown","greenyellow","deepskyblue"]
	for (i in districts_lau_codes[1]) {
		let district_numbers = [];
		for (j in data) {
			if (data[j]['okres_lau_kod'] == districts_lau_codes[1][i]) {		
				amount = data[j]['kumulativni_pocet_nakazenych']-data[j]['kumulativni_pocet_umrti']-data[j]['kumulativni_pocet_vylecenych'];		
				percentage = ((amount/districts_lau_codes[2][i])*100000).toFixed(0);
				if (mode == 'rel') {
					district_numbers.push(percentage);
				} else {
					district_numbers.push(amount);
				}
				
			}
		}				
	
		let regions_codes = districts_lau_codes[3].filter(onlyUnique);
		let region_color;
		for (r in regions_codes) {
			if ((districts_lau_codes[1][i] !== null) && (regions_codes[r] == (districts_lau_codes[3][i]))) {
				region_color = region_colors[r];
			}
		}
		let district_data = {
			label: districts_lau_codes[0][i],
			data: district_numbers,
			lineTension: 0,
    		fill: false,
    		borderColor: region_color
		}
		districts.push(district_data);
	}	
	headline = (mode == 'rel') ? 'Počet aktivních nakažených Covid-19 na 100 000 obyvatel podle okresů ČR (data doplňována s týdenním zpožděním)':
	'Počet aktivních nakažených Covid-19 podle okresů ČR (data doplňována s týdenním zpožděním)'
	graf(data, axisX, districts, target, headline);
}

function graf(data_file, axisX, districts, target, headline) {
	let ctx;
	headline = headline;
	ctx = document.getElementById(target).getContext('2d');
	let yAxes_settings;
	if (target == "myChart3") {
		yAxes_settings = [
            {
            	id: 'B',
            	position: 'left',
                ticks: {
                    fontColor: "blue",
                }
            },
            {
            	id: 'A',
            	position: 'right',
                ticks: {
                    fontColor: "orange",
                    callback: function(value, index, values) {
                        return value + ' %';
                    }
                }
            }
            ]
	} else {
		yAxes_settings = [
            {
            	id: 'A',
            	position: 'left',
                ticks: {
                    fontColor: "black"
                }
            }
         ]
	}
	let lineChart = new Chart(ctx, {
	  type: 'line',
	  data: {
	    labels: axisX,
	    datasets: districts
	  },
	  options: {
	  	legend: {
            labels: {
                fontColor: "black",
                fontSize: 10
            }
        },
	  	title: {
	  		display: true,
	  		text: headline,
	  		fontColor: 'black',
	  		fontStyle: 'bold',
	  		fontSize: 20
	  	},
	  	scales: {
            yAxes: yAxes_settings,
            xAxes: [{
                ticks: {
                    fontColor: "black",                    
                    min: 0
                }
            }]
        },
        plugins: {
			zoom: {
				pan: {
					enabled: false,
					mode: 'xy',
					rangeMin: {
						x: null,
						y: null
					},
					rangeMax: {
						x: null,
						y: null
					},
					speed: 20,
					threshold: 10,
				},
				zoom: {
					enabled: true,
					drag: true,
					mode: 'xy',
					rangeMin: {
						x: null,
						y: null
					},
					rangeMax: {
						x: null,
						y: null
					},
					speed: 0.1,
					threshold: 2,
					sensitivity: 3,
				}
			}
		}
}
	});
	$(".myChart_onoff").click(function() {
		let id = (this.id == "myChart1_onoff") ? 0 : 1;
		if (lineChart.id == id) {
		    lineChart.data.datasets.forEach(function(ds) {
		    ds.hidden = !ds.hidden;
		  	});
		  	lineChart.update();
		}		
	});
	$(".myChart_resetzoom").click(function() {
		if (this.id == "myChart"+(lineChart.id+1)+"_resetzoom") {
			lineChart.resetZoom();
		}		
	});
}

function setting_date3(data_file, axisX) {
	if (data_file) {
		for (i in data_file) {
			if (i > 33) {
				if (date5 && (!(date5.includes(data_file[i]['datum'])))) {
				date5.push(data_file[i]['datum']);
				}
			}			
		}
	} else {
		alert("Data se nepodařilo načíst! Prosím, aktualizujte stránku.");
	}
	setting_numbers3(data_file, date5);
	setting_numbers4(data_file, date5);
	setting_numbers5(data_file, date5);
	setting_numbers6(data_file, date5);
}

function setting_numbers3(data_file, axisX) {
	let cz = []; 
	let numbers_CZ_ratio = [];
	let numbers_CZ_mortality = [];
	let numbers_CZ_tests = [];

	for (let j = 34; j < data_file.length; j++) {
		numbers_CZ_ratio.push((((data_file[j]['kumulativni_pocet_nakazenych'])/(data_file[j]['kumulativni_pocet_testu']))*100).toFixed(4));
		numbers_CZ_mortality.push((((data_file[j]['kumulativni_pocet_umrti'])/(data_file[j]['kumulativni_pocet_nakazenych']))*100).toFixed(4));
		numbers_CZ_tests.push(data_file[j]['kumulativni_pocet_testu']);
	}	
	numbers_CZ_ratio = {
		label: "Poměr nakažených ku testům (% kumulativně)",
		data: numbers_CZ_ratio,
		lineTension: 0,
    	fill: false,
    	borderColor: "orange",
    	yAxisID: 'A'
	}
	numbers_CZ_mortality = {
		label: "Smrtnost (% kumulativně)",
		data: numbers_CZ_mortality,
		lineTension: 0,
    	fill: false,
    	borderColor: "black",
    	yAxisID: 'A'
	}
	numbers_CZ_tests = {
		label: "Absolutní počet testů",
		data: numbers_CZ_tests,
		lineTension: 0,
    	fill: false,
    	borderColor: "blue",
    	yAxisID: 'B'
	}
	cz.push(numbers_CZ_ratio, numbers_CZ_mortality, numbers_CZ_tests);
	let tests_chart_title3 = (cz[2]['data'][(cz[2]['data']).length-1] == cz[2]['data'][(cz[2]['data']).length-2]) ? 
	'Covid-19 - Koeficient celkové pozitivity a smrtnosti v ČR (chybí počet testů za včerejší den!)':
	'Covid-19 - Koeficient celkové pozitivity a smrtnosti v ČR';
	graf(data, axisX, cz, "myChart3", tests_chart_title3)
}

function setting_numbers4(data_file, axisX) {
	let cz = []; 
	let numbers_CZ_infected = [];
	let numbers_CZ_recovered = [];
	let numbers_CZ_dead = [];
	let numbers_CZ_active = [];

	for (let j = 34; j < data_file.length; j++) {
		numbers_CZ_infected.push(data_file[j]['kumulativni_pocet_nakazenych']);
		numbers_CZ_recovered.push(data_file[j]['kumulativni_pocet_vylecenych']);
		numbers_CZ_dead.push(data_file[j]['kumulativni_pocet_umrti']);
		numbers_CZ_active.push(data_file[j]['kumulativni_pocet_nakazenych']-
			data_file[j]['kumulativni_pocet_vylecenych']-data_file[j]['kumulativni_pocet_umrti']);
	}	
	numbers_CZ_infected = {
		label: "Celkový počet nakažených",
		data: numbers_CZ_infected,
		lineTension: 0,
    	fill: false,
    	borderColor: "darkred"
	}
	numbers_CZ_recovered = {
		label: "Celkový počet vyléčených",
		data: numbers_CZ_recovered,
		lineTension: 0,
    	fill: false,
    	borderColor: "green"
	}
	numbers_CZ_dead = {
		label: "Celkový počet zemřelých",
		data: numbers_CZ_dead,
		lineTension: 0,
    	fill: false,
    	borderColor: "black"
	}
	numbers_CZ_active = {
		label: "Aktuální počet nakažených",
		data: numbers_CZ_active,
		lineTension: 0,
    	fill: false,
    	borderColor: "red"
	}
	cz.push(numbers_CZ_infected, numbers_CZ_recovered, numbers_CZ_dead, numbers_CZ_active);
	graf(data, axisX, cz, "myChart4", 'Covid-19 - Počty nakažených, vyléčených a zemřelých')
}

function setting_numbers5(data_file, axisX) {
	let cz = []; 
	let numbers_CZ_infected_daily = [];
	let numbers_CZ_recovered_daily = [];
	let numbers_CZ_dead_daily = [];

	for (let j = 34; j < data_file.length; j++) {
		numbers_CZ_infected_daily.push(data_file[j]['kumulativni_pocet_nakazenych']-data_file[j-1]['kumulativni_pocet_nakazenych']);
		numbers_CZ_recovered_daily.push(data_file[j]['kumulativni_pocet_vylecenych']-data_file[j-1]['kumulativni_pocet_vylecenych']);
		numbers_CZ_dead_daily.push(data_file[j]['kumulativni_pocet_umrti']-data_file[j-1]['kumulativni_pocet_umrti']);
	}	
	numbers_CZ_infected_daily = {
		label: "Počet nových nakažených za den",
		data: numbers_CZ_infected_daily,
    	backgroundColor: "red",
		barThickness: 2
	}
	numbers_CZ_recovered_daily = {
		label: "Počet nových vyléčených za den",
		data: numbers_CZ_recovered_daily,
    	backgroundColor: "green",
		barThickness: 2
	}
	numbers_CZ_dead_daily = {
		label: "Počet nových zemřelých za den",
		data: numbers_CZ_dead_daily,
    	backgroundColor: "black",
		barThickness: 2
	}
	cz.push(numbers_CZ_infected_daily, numbers_CZ_recovered_daily, numbers_CZ_dead_daily);
	graf5(data_file, axisX, cz, "myChart5", 'Covid-19 - Denní počty nových nakažených, vyléčených a zemřelých')
}

function setting_numbers6(data_file, axisX) {
	let cz = []; 
	let numbers_CZ_tests_daily = [];
	let numbers_CZ_positivity_daily = [];

	for (let j = 34; j < data_file.length; j++) {
		numbers_CZ_tests_daily.push(data_file[j]['kumulativni_pocet_testu']-data_file[j-1]['kumulativni_pocet_testu']);
		numbers_CZ_positivity_daily.push(
			(((data_file[j]['kumulativni_pocet_nakazenych']-data_file[j-1]['kumulativni_pocet_nakazenych'])/
									(data_file[j]['kumulativni_pocet_testu']-data_file[j-1]['kumulativni_pocet_testu']))*100).toFixed(2)
			);
	}	
	numbers_CZ_tests_daily = {
		label: "Počet testů za den",
		data: numbers_CZ_tests_daily,
    	backgroundColor: "blue",
		barThickness: 2,
		yAxisID: 'A'
	}
	numbers_CZ_positivity_daily = {
		label: "Podíl pozitivních případů za den (%)",
		data: numbers_CZ_positivity_daily,
    	backgroundColor: "red",
		barThickness: 2,
		yAxisID: 'B'
	}
	cz.push(numbers_CZ_tests_daily, numbers_CZ_positivity_daily);
	let tests_chart_title6 = (cz[1]['data'][(cz[1]['data']).length-1] == "Infinity") ?
	'Covid-19 - Denní počty testů a podíly nakažených (chybí počet testů za včerejší den!)':
	'Covid-19 - Denní počty testů a podíly nakažených';
	graf5(data_file, axisX, cz, "myChart6", tests_chart_title6)
}

function graf5(data_file, axisX, cz, target, headline) {
	let ctx;
	headline = headline;
	ctx = document.getElementById(target).getContext('2d');
	if (target == "myChart6") {
		yAxes_settings = [
            {
            	id: 'A',
            	position: 'left',
                ticks: {
                    fontColor: "blue",
                }
            },
            {
            	id: 'B',
            	position: 'right',
                ticks: {
                    fontColor: "red",
                    callback: function(value, index, values) {
                        return value + ' %';
                    },
                    min: 0/*,
                    max: 45*/
                }
            }
            ]
	} else {
		yAxes_settings = [
            {
            	id: 'A',
            	position: 'left',
                ticks: {
                    fontColor: "black",
                }
            }
         ]
	}
	let myBarChart = new Chart(ctx, {
	    type: 'bar',
	    data: {
	    	labels: axisX,
		    datasets: cz
		},
	    options: {
		  	legend: {
	            labels: {
	                fontColor: "black",
	                fontSize: 10
	            }
	        },
		  	title: {
		  		display: true,
		  		text: headline,
		  		fontColor: 'black',
		  		fontStyle: 'bold',
		  		fontSize: 20
		  	},
		  	scales: {
	            yAxes: yAxes_settings,
	            xAxes: [{
	                ticks: {
	                    fontColor: "black",
	                }
	            }]
	        },
	        plugins: {
				zoom: {
					pan: {
						enabled: false,
						mode: 'xy',
						rangeMin: {
							x: null,
							y: null
						},
						rangeMax: {
							x: null,
							y: null
						},
						speed: 20,
						threshold: 10,
					},
					zoom: {
						enabled: true,
						drag: true,
						mode: 'xy',
						rangeMin: {
							x: null,
							y: null
						},
						rangeMax: {
							x: null,
							y: null
						},
						speed: 0.1,
						threshold: 2,
						sensitivity: 3,
					}
				}
			}
		}
	});
	$(".myChart_resetzoom").click(function() {
		if (this.id == "myChart"+(myBarChart.id+1)+"_resetzoom") {
			myBarChart.resetZoom();
		}		
	});
}